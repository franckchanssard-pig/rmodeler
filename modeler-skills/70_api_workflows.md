# API Workflows (Practical Modeling Ops)

Goal: repeatable API steps for common modeling tasks.

## 1) Auth
- Use a **Bearer token** valid for `/api/workspace/...` endpoints.
- Tokens can expire quickly; re‑issue if you receive `401 invalid_token`.

## 2) List creation
Endpoint:
```
POST /api/workspace/{applicationId}/list/CreateWithDefaultView
```
Payload (minimal):
```
{
  "friendlyName": "My List",
  "isDimension": false,
  "properties": [
    {"friendlyName":"ID","type":"Integer","isUnique":false,"readableByEveryone":true,"isAutoGenerated":false},
    {"friendlyName":"value","type":"Number","isUnique":false,"readableByEveryone":true,"isAutoGenerated":false}
  ],
  "defaultPropertyFriendlyName": "ID",
  "displayPropertyFriendlyName": "ID",
  "propertiesPublicByDefault": true,
  "sharingStatus": "Private"
}
```

## 3) Metric creation
Endpoint:
```
POST /api/workspace/{applicationId}/metric/CreateFromConfiguration
```
Required fields (per `NewMetric`):
- `friendlyName`, `description`, `dimensions`, `type`, `visibility`

Example payload (Number metric by Customer only):
```
{
  "friendlyName": "metric test",
  "description": "Test metric",
  "dimensions": ["<customer_list_id>"],
  "type": "Number",
  "visibility": "Local",
  "readableByEveryone": true
}
```

## 4) Metric formulas (read)
Use **formula audit** to get the raw formula by metric id:
```
GET /api/workspace/internals/formula/FindFormulasBySearchId?organizationId={orgId}&searchId={metricId}
```
Returns `rawFormula` for the metric.

## 5) Board creation with a view block
Create a board and place a **View block** (e.g., the metric’s default view):
```
POST /api/workspace/{applicationId}/board/Create
```
Minimal payload:
```
{
  "name": "board test",
  "description": "Board with metric test",
  "icon": "ChartBar",
  "iconColor": "Blue",
  "boardSharingStatus": "Private",
  "blocks": [
    {
      "blockId": "<view_id>",
      "blockType": "View",
      "boardBlockPosition": {"x":0,"y":0,"width":6,"height":6},
      "viewBoardBlockConfig": {
        "boardBlockDisplayType": "Table",
        "contentId": "<view_id>",
        "title": "metric test",
        "showTitle": true,
        "allowAddingNewItemsFromWidget": false
      }
    }
  ]
}
```

## Notes
- `/api/v1/blocks` did not accept the same bearer token (401). Favor `/api/workspace/...`.
- Create endpoints often return a **default view id** you can place on boards.
